{% load static %}
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Food Metrics Login</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
      <link rel="stylesheet" href="{% static 'css/styles.css' %}">
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
      <!-- Bootstrap CSS -->
        <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        />

        <!-- Bootstrap Icons -->
        <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
        />
   </head>
   <body>
      <div class="container-fluid login-container">
         <header class="d-flex align-items-center mb-4">
            <span class="logo-text">Petpooja</span>
            <span class="logo-metrics">Food Metrics</span>
         </header>
         <div class="row align-items-center justify-content-center h-100">
            <div class="col-lg-6 d-none d-lg-flex flex-column justify-content-center welcome-section">
               <h1 class="welcome-heading">Welcome!</h1>
               <p class="welcome-text">Lorem ipsum has been the industry's standard dummy text ever since the 1500s.</p>
               <div class="illustration-container">
                  <img src="{% static 'images/login/login.svg' %}" alt="Data Analytics Illustration" class="img-fluid login-illustration">
               </div>
            </div>
            <div class="col-lg-6 col-md-8 login-form-col">
               <div class="login-card p-4">
                  <h2 class="login-heading">Login</h2>
                  <p class="login-text">Enter your credentials and get started to know the insights around you.</p>
                  <div id="error-message" class="error-message mb-3" style="display: none;">
                     Invalid Email or Password. Please try again.
                  </div>
                  <form id="login-form" method="post">
                     {% csrf_token %} 
                     <div class="mb-3">
                        <label for="email" class="form-label">Email Id</label>
                        <input type="email" class="form-control" id="email" name="email" value="" required>
                     </div>
                     <div class="mb-3">
                        <label for="password" class="form-label d-flex justify-content-between">
                        <span>Password</span>
                        <a href="{% url 'forgot-password-page' %}" class="forgot-password-link">Forgot Password?</a>
                        </label>
                        <div class="input-group">
                           <input type="password" class="form-control " id="password" name="password" value="" required>
                           <span class="input-group-text toggle-password" id="togglePassword">
                            <i class="bi bi-eye-slash"></i>
                          </span>
                        </div>
                     </div>
                     <!-- <div class="mb-4 d-flex justify-content-between align-items-center">
                        <div class="form-check">
                           <input class="form-check-input" type="checkbox" value="" id="rememberMe">
                           <label class="form-check-label remember-me-label" for="rememberMe">
                           Remember Me
                           </label>
                        </div>
                     </div> -->
                     <button type="submit" class="btn btn-primary w-100 login-btn">Login</button>
                  </form>
                  <div class="text-center mt-3">
                     <span class="sign-up-text">You don't have account? <a href="{% url 'signup-page' %}" class="sign-up-link">Sign up</a></span>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
      <script>

        const togglePassword = document.getElementById("togglePassword");
        const passwordInput = document.getElementById("password");
        const icon = togglePassword.querySelector("i");
    
        togglePassword.addEventListener("click", () => {
        const type =
            passwordInput.getAttribute("type") === "password" ? "text" : "password";
        passwordInput.setAttribute("type", type);
    
        // Toggle between eye and eye-slash
        icon.classList.toggle("bi-eye");
        icon.classList.toggle("bi-eye-slash");
        });


        document.addEventListener("DOMContentLoaded", function () {
            const loginForm = document.getElementById("login-form");
            const errorMessage = document.getElementById("error-message");

            loginForm.addEventListener("submit", function (event) {
                event.preventDefault(); // Prevent normal form submission

                // Collect form data
                const formData = {
                    email: document.getElementById("email").value,
                    password: document.getElementById("password").value,
                };

                // Get CSRF token from form (Django requires it)
                const csrfToken = document.querySelector("[name=csrfmiddlewaretoken]").value;

                // Send AJAX POST request
                fetch("{% url 'login' %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrfToken,
                    },
                    body: JSON.stringify(formData),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.access_token) {
                        // Redirect to home page
                        window.location.href = data.redirect_url || "home/";
                    } else {
                        // Show error message
                        errorMessage.style.display = "block";
                        errorMessage.innerText = data.message || "Invalid email or password.";
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    errorMessage.style.display = "block";
                    errorMessage.innerText = "Something went wrong. Please try again.";
                });
            });
        });

      </script>

   </body>
</html>